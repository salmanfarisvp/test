{
  "version": 3,
  "sources": ["../src/index.ts", "../src/cli.ts"],
  "sourcesContent": ["import { build, BuildOptions, Loader, Plugin } from 'esbuild'\nimport { extname, dirname, sep } from 'path'\nimport { readFile } from 'fs/promises'\nimport { basename, parse } from 'path'\nimport { green, red, yellow, white } from 'kleur/colors'\nimport { gzipSize } from 'gzip-size'\nimport brotliSizeModule from 'brotli-size'\nimport prettyBytes from 'pretty-bytes'\nimport fastGlob from 'fast-glob'\nimport { writeFileSync } from 'fs'\nimport { generateDtsBundle, LibrariesOptions, OutputOptions } from 'dts-bundle-generator'\nimport { debug, error, info, log, time, timeEnd, warn } from '@jsheaven/status-message'\n\n/** adds spaces from left so that all lines are visually in line vertically */\nexport const getPadLeft = (str: string, width: number, char = ' ') => char.repeat(width - str.length)\n\n/** formats the byte/kByte sizes with coloring */\nexport const formatSize = (size: number, filename: string, type?: string, raw?: boolean) => {\n  const pretty = raw ? `${size} B` : prettyBytes(size)\n  const color = size < 5000 ? green : size > 40000 ? red : yellow\n  const indent = getPadLeft(pretty, 13)\n  return `${indent}${color(pretty)}: ${white(basename(filename))}${type ? `.${type}` : ''}`\n}\n\n/** returns the text of all file sizes per compression */\nexport const getSizeInfo = async (code: string, filename: string, raw: boolean) => {\n  raw = raw || code.length < 5000\n\n  const [gzip, brotli] = await Promise.all([\n    gzipSize(code).catch(() => null),\n    // @ts-ignore\n    brotliSizeModule.default(code).catch(() => null),\n  ])\n\n  let out = formatSize(gzip, filename, 'gz', raw)\n  if (brotli) {\n    out += '\\n' + formatSize(brotli, filename, 'br', raw)\n  }\n  return out\n}\n\n/** adds all node_module imports to external so that --bundle in esbuild is not bundling them in */\nexport const makeAllPackagesExternalPlugin: Plugin = {\n  name: 'make-all-packages-external',\n  setup(build) {\n    let filter = /^[^.\\/]|^\\.[^.\\/]|^\\.\\.[^\\/]/ // Must not start with \"/\" or \"./\" or \"../\"\n    build.onResolve({ filter }, (args) => ({ path: args.path, external: true }))\n  },\n}\n\n/** makes sure that all \"/Users/admin/Code/easybundle/src\" and \"/Users/admin/Code/easybundle/src/index.ts\" occurances are replaced why the actual filenames */\nexport const esmDirnamePlugin: Plugin = {\n  name: 'esmDirname',\n  setup(build) {\n    const nodeModules = new RegExp(/^(?:.*[\\\\\\/])?node_modules(?:[\\\\\\/].*)?$/)\n    build.onLoad({ filter: /.*/ }, async ({ path }) => {\n      if (!path.match(nodeModules)) {\n        let contents = await readFile(path, 'utf8')\n        const loader = extname(path).substring(1) as Loader\n        const _dirname = dirname(path)\n        contents = contents.replaceAll('\"/Users/admin/Code/easybundle/src\"', `\"${_dirname}\"`).replaceAll('\"/Users/admin/Code/easybundle/src/index.ts\"', `\"${path}\"`)\n        return {\n          contents,\n          loader,\n        }\n      }\n    })\n  },\n}\n\n/** default baseConfig for esbuild */\nexport const baseConfig: BuildOptions = {\n  sourcemap: 'linked',\n  target: 'esnext',\n  bundle: true,\n  minify: true,\n  minifySyntax: true,\n  minifyIdentifiers: true,\n  minifyWhitespace: true,\n  legalComments: 'none',\n}\n\n/** prints all file sizes for the generated JS files */\nconst printFileSizes = async (outfile: string) => {\n  const outfileParsed = parse(outfile)\n  log('OK', 'Find your bundle in', outfileParsed.dir)\n  const file = await fastGlob(`${outfileParsed.dir}${sep}${outfileParsed.name}*{js,map,d.ts}`)\n\n  for (let i = 0; i < file.length; i++) {\n    const filePath = file[i]\n    const code = await readFile(filePath, { encoding: 'utf8' })\n    if (filePath.endsWith('.js')) {\n      console.log(await getSizeInfo(code, filePath, false))\n    }\n    console.log(formatSize(Buffer.from(code).byteLength, filePath))\n  }\n}\n\n/** rewrites the outfile name from e.g. ./dist/index.js to ./dist/index.esm.js, ./dist/index.iife.js */\nexport const getOutfileName = (fileName: string, subType: BuildOptions['format']) => {\n  const fileNameParsed = parse(fileName)\n  return `${fileNameParsed.dir}${sep}${fileNameParsed.name}.${subType}${fileNameParsed.ext}`\n}\n\n/** options applied, when debug is enabled */\nexport const debugBuildOptions: Partial<BuildOptions> = {\n  minify: false,\n  minifySyntax: false,\n  minifyIdentifiers: false,\n  minifyWhitespace: false,\n}\n\n/** calls esbuild with a dynamic configuration per format */\nexport const genericBuild = async ({\n  outputFormats,\n  entryPoint,\n  outfile,\n  esBuildOptions,\n  debug: isDebug,\n  dts,\n  tsConfigPath,\n  dtsLibOptions,\n  dtsOutputOptions,\n}: BundleConfig) => {\n  time('BUNDLED IN')\n\n  if (isDebug) {\n    // override minification parameters\n    // but let the user still influence them\n    esBuildOptions = {\n      ...esBuildOptions,\n      ...debugBuildOptions,\n    } as BuildOptions\n\n    debug(\n      'CONFIG',\n      'easybundle',\n      {\n        entryPoint,\n        outfile,\n        esBuildOptions,\n        debug: isDebug,\n        dts,\n        tsConfigPath,\n        dtsLibOptions,\n        dtsOutputOptions,\n      },\n      'esbuild plugins',\n      esBuildOptions.plugins,\n    )\n  }\n\n  time('BUILT IN')\n  info('BUILD', 'Transpiling', entryPoint, '...')\n\n  await Promise.all(\n    outputFormats.map(async (format: BuildOptions['format']) =>\n      build({\n        format,\n        entryPoints: [entryPoint],\n        outfile: getOutfileName(outfile, format),\n        ...(esBuildOptions || {}),\n      } as BuildOptions),\n    ),\n  )\n  timeEnd('BUILT IN')\n\n  if (dts) {\n    time('DTS IN')\n    info('DTS', 'Generating .d.ts files...')\n    try {\n      const dTsBundles = generateDtsBundle(\n        [\n          {\n            filePath: entryPoint,\n            libraries: dtsLibOptions,\n            output: dtsOutputOptions,\n          },\n        ],\n        { preferredConfigPath: tsConfigPath },\n      )\n\n      for (let i = 0; i < outputFormats.length; i++) {\n        const format = outputFormats[i]\n        const outFileNameParsed = parse(getOutfileName(outfile, format))\n        const declarationOutFile = `${outFileNameParsed.dir}${sep}${outFileNameParsed.name}.d.ts`\n        writeFileSync(declarationOutFile, dTsBundles[0], { encoding: 'utf-8' })\n      }\n    } catch (e) {\n      if (/Symbol for root source file (.*) not found/.test(e.toString())) {\n        warn('DTS', 'No type exports found. Skipping.')\n      } else {\n        error('DTS', 'Error while generating .d.ts files: ', e)\n      }\n    }\n    timeEnd('DTS IN')\n  }\n  await printFileSizes(outfile)\n\n  timeEnd('BUNDLED IN')\n}\n\nexport interface BundleConfig {\n  /** allows to customize the output formats that esbuild would generate. default: ['iife', 'esm', 'cjs'] */\n  outputFormats?: Array<BuildOptions['format']>\n\n  /** shall the output not be minified and treeShaked but left readable?  default: false */\n  debug?: boolean\n\n  /** a file to start bundling for. e.g. ./src/index.ts */\n  entryPoint: string\n\n  /** a file to write to. e.g. ./dist/index.js */\n  outfile: string\n\n  /** shall the output include .d.ts type declarations? (takes much longer to compile); default: true */\n  dts?: boolean\n\n  /** allows to inline types of libraries etc. */\n  dtsLibOptions?: LibrariesOptions\n\n  /** allows to control .d.ts. bundle specifics */\n  dtsOutputOptions?: OutputOptions\n\n  /** path to a tsconfig.json file, if existing; default: 'tsconfig.json' */\n  tsConfigPath?: string\n\n  /** esbuild BuildConfig to override internal configuration */\n  esBuildOptions?: BuildOptions\n}\n\nexport const genericDefaultBundleConifg: Partial<BundleConfig> = {\n  outputFormats: ['iife', 'esm', 'cjs'],\n  dts: true,\n  tsConfigPath: 'tsconfig.json',\n  dtsOutputOptions: {\n    exportReferencedTypes: true,\n    inlineDeclareExternals: true,\n    inlineDeclareGlobals: true,\n    noBanner: true,\n    sortNodes: true,\n  },\n}\n\nexport const defaultBundleConfigBrowser: Partial<BundleConfig> = {\n  ...genericDefaultBundleConifg,\n  esBuildOptions: {\n    ...baseConfig,\n    platform: 'browser',\n    plugins: [esmDirnamePlugin],\n  },\n}\n\nexport const defaultBundleConfigNode: Partial<BundleConfig> = {\n  ...genericDefaultBundleConifg,\n  esBuildOptions: {\n    ...baseConfig,\n    platform: 'node',\n    plugins: [esmDirnamePlugin, makeAllPackagesExternalPlugin],\n  },\n}\n\n/** configures esbuild to build one file for a browser environment; defaults: defaultBundleConfigBrowser  */\nexport const buildForBrowser = async (config: BundleConfig) =>\n  genericBuild({\n    ...defaultBundleConfigBrowser,\n    ...config,\n    dtsOutputOptions: {\n      ...defaultBundleConfigBrowser.dtsOutputOptions,\n      ...(config.dtsOutputOptions || {}),\n    },\n    esBuildOptions: {\n      ...defaultBundleConfigBrowser.esBuildOptions,\n      ...(config.esBuildOptions || {}),\n    },\n  })\n\n/** configures esbuild to build one file for a Node.js environment; defaults: defaultBundleConfigNode */\nexport const buildForNode = async (config: BundleConfig) =>\n  genericBuild({\n    ...defaultBundleConfigNode,\n    ...config,\n    dtsOutputOptions: {\n      ...defaultBundleConfigNode.dtsOutputOptions,\n      ...(config.dtsOutputOptions || {}),\n    },\n    esBuildOptions: {\n      ...defaultBundleConfigNode.esBuildOptions,\n      ...(config.esBuildOptions || {}),\n    },\n  })\n", "#!/usr/bin/env node\n'use strict'\n\nconst entryPoint = process.argv[2] || './src/index.ts'\nconst outfile = process.argv[3] || './dist/index.js'\nconst platform = process.argv[4] || 'node'\n\nif (platform === 'browser') {\n  import('./index').then(({ buildForBrowser }) =>\n    buildForBrowser({\n      entryPoint,\n      outfile,\n    }),\n  )\n} else {\n  import('./index').then(({ buildForNode }) =>\n    buildForNode({\n      entryPoint,\n      outfile,\n    }),\n  )\n}\n"],
  "mappings": "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",
  "names": ["import_path", "prettyBytes", "brotliSizeModule", "build", "outfile", "fastGlob", "entryPoint", "buildForBrowser", "buildForNode"]
}
