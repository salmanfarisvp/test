{
  "version": 3,
  "sources": ["../src/codegen.ts"],
  "sourcesContent": ["import { readFileSync, writeFileSync } from \"fs\"\nimport { resolve } from \"path\"\nimport { parse } from 'csv-parse'\nimport lzTs from 'lz-ts';\nconst { compressToURI } = lzTs;\n\nimport { CountryIso2, BaseData, BaseDataRow } from \"./interfaces\"\n\nimport s2geo from 's2-geometry';\nconst { S2 } = s2geo;\n\nimport { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n\nconst csvParser = parse({\n  delimiter: ',',\n  quote: '\"'\n})\n\ninterface CountryLookupMapIso2 {\n    [code: string]: CountryIso2\n}\n\nexport const transformCountryListIso2ToCodeLookupMap = (countriesList: Array<Array<string>>): CountryLookupMapIso2 => {\n    const countryMapIso2: CountryLookupMapIso2 = {}\n    countriesList.forEach((country: Array<string>, index: number) => {\n        countryMapIso2[country[0]] = {\n            code: country[0],\n            name: country[1],\n            index\n        }\n    })\n    return countryMapIso2\n}\n\nexport const getRawCityCountryList = async(countryMapIso2: CountryLookupMapIso2, citiesAndCountries: string, minPopulation: number = 15000): Promise<BaseData> => {\n    return new Promise((resolve) => {\n        const data: BaseData = []\n        csvParser.on('readable', function(){\n            let record;\n            while ((record = csvParser.read()) !== null) {\n                const [cityNameAscii,,lat,lng,,iso2,,,capital,population,] = record\n                // all major cities of the world, population >= minPopulation \n                // and all capital cities, even if < minPopulation\n                const latFloat = parseFloat(lat)\n                const lngFloat = parseFloat(lng)\n\n                if ((parseInt(population) >= minPopulation || capital) && latFloat && lngFloat) {\n                    data.push([\n                        S2.latLngToKey(latFloat, lngFloat, 8),\n                        cityNameAscii,\n                        countryMapIso2[iso2].index,\n                    ]);\n                }\n            }\n        });\n\n        csvParser.on('end', async() => {\n\n            // pre-sort by country primary key\n            data.sort((a: BaseDataRow, b: BaseDataRow) => {\n                return (a[2] as number) - (b[2] as number)\n            })\n            resolve(data)\n        });\n        csvParser.write(citiesAndCountries)\n        csvParser.end()\n    })\n}\n\nexport const encodeData = (rows: BaseData) => {\n    let data = ''\n    let currentCountryCode: number|null = null\n    rows.forEach((row, index) => {\n        const nextRow = rows[index+1]\n        data += `${row[0]}${row[1]}\\n`\n        if (nextRow && nextRow[2]) {\n            if (currentCountryCode === null || (nextRow && nextRow[2] !== currentCountryCode)) {\n                data += `${nextRow[2]}\\n`\n                currentCountryCode = nextRow[2] as number\n            }\n        }\n    })\n    return data\n}\n\nexport const compressBaseData = (rows: BaseData): string => compressToURI(encodeData(rows))\n\n;(async() => {\n\n    // countries\n    const countriesList = JSON.parse(\n        readFileSync(resolve(__dirname, '../data/countriesIso2.json'), { encoding: 'utf8' })\n    ).map((countryIso2: CountryIso2) => ([countryIso2.code, countryIso2.name]))\n\n    writeFileSync(resolve(__dirname, '../src/gen/baseDataCountries.ts'), `\n    export const BASE_DATA_COUNTRIES = \\`${compressBaseData(countriesList)}\\`;\n    `)\n\n    // cities\n    const baseDataCities = await getRawCityCountryList(\n        transformCountryListIso2ToCodeLookupMap(countriesList),\n        readFileSync(resolve(__dirname, '../data/worldcities.csv'), { encoding: 'utf8' })\n    )\n    writeFileSync(resolve(__dirname, '../src/gen/baseDataCities.ts'), `\n    export const BASE_DATA_CITIES = \\`${compressBaseData(baseDataCities)}\\`;\n    `)\n})()\n\n"],
  "mappings": "8sBAAA,IAAAA,EAA4C,QAC5CC,EAAwB,UACxBC,EAAsB,eACtBC,EAAiB,gBAKjBC,EAAkB,sBAGlBC,EAA8B,SAC9BJ,EAAwB,UAZxBK,EAAA,GAIM,CAAE,cAAAC,CAAc,EAAI,EAAAC,QAKpB,CAAE,GAAAC,CAAG,EAAI,EAAAC,QAKTC,KAAa,iBAAcL,EAAY,GAAG,EAC1CM,KAAY,WAAQD,CAAU,EAG9BE,KAAY,SAAM,CACtB,UAAW,IACX,MAAO,GACT,CAAC,EAMYC,EAA2CC,GAA8D,CAClH,IAAMC,EAAuC,CAAC,EAC9C,OAAAD,EAAc,QAAQ,CAACE,EAAwBC,IAAkB,CAC7DF,EAAeC,EAAQ,CAAC,CAAC,EAAI,CACzB,KAAMA,EAAQ,CAAC,EACf,KAAMA,EAAQ,CAAC,EACf,MAAAC,CACJ,CACJ,CAAC,EACMF,CACX,EAEaG,EAAwB,MAAMH,EAAsCI,EAA4BC,EAAwB,OAC1H,IAAI,QAASC,GAAY,CAC5B,IAAMC,EAAiB,CAAC,EACxBV,EAAU,GAAG,WAAY,UAAU,CAC/B,IAAIW,EACJ,MAAQA,EAASX,EAAU,KAAK,KAAO,MAAM,CACzC,GAAM,CAACY,EAAc,CAACC,EAAIC,EAAI,CAACC,EAAK,CAAC,CAACC,EAAQC,CAAW,EAAIN,EAGvDO,EAAW,WAAWL,CAAG,EACzBM,EAAW,WAAWL,CAAG,GAE1B,SAASG,CAAU,GAAKT,GAAiBQ,IAAYE,GAAYC,GAClET,EAAK,KAAK,CACNd,EAAG,YAAYsB,EAAUC,EAAU,CAAC,EACpCP,EACAT,EAAeY,CAAI,EAAE,KACzB,CAAC,EAGb,CAAC,EAEDf,EAAU,GAAG,MAAO,SAAW,CAG3BU,EAAK,KAAK,CAACU,EAAgBC,IACfD,EAAE,CAAC,EAAgBC,EAAE,CAAC,CACjC,EACDZ,EAAQC,CAAI,CAChB,CAAC,EACDV,EAAU,MAAMO,CAAkB,EAClCP,EAAU,IAAI,CAClB,CAAC,EAGQsB,EAAcC,GAAmB,CAC1C,IAAIb,EAAO,GACPc,EAAkC,KACtC,OAAAD,EAAK,QAAQ,CAACE,EAAKpB,IAAU,CACzB,IAAMqB,EAAUH,EAAKlB,EAAM,CAAC,EAC5BK,GAAQ,GAAGe,EAAI,CAAC,IAAIA,EAAI,CAAC;AAAA,EACrBC,GAAWA,EAAQ,CAAC,IAChBF,IAAuB,MAASE,GAAWA,EAAQ,CAAC,IAAMF,KAC1Dd,GAAQ,GAAGgB,EAAQ,CAAC;AAAA,EACpBF,EAAqBE,EAAQ,CAAC,EAG1C,CAAC,EACMhB,CACX,EAEaiB,EAAoBJ,GAA2B7B,EAAc4B,EAAWC,CAAI,CAAC,GAExF,SAAW,CAGT,IAAMrB,EAAgB,KAAK,SACvB,mBAAa,WAAQH,EAAW,4BAA4B,EAAG,CAAE,SAAU,MAAO,CAAC,CACvF,EAAE,IAAK6B,GAA8B,CAACA,EAAY,KAAMA,EAAY,IAAI,CAAE,KAE1E,oBAAc,WAAQ7B,EAAW,iCAAiC,EAAG;AAAA,2CAC9B4B,EAAiBzB,CAAa;AAAA,KACpE,EAGD,IAAM2B,EAAiB,MAAMvB,EACzBL,EAAwCC,CAAa,KACrD,mBAAa,WAAQH,EAAW,yBAAyB,EAAG,CAAE,SAAU,MAAO,CAAC,CACpF,KACA,oBAAc,WAAQA,EAAW,8BAA8B,EAAG;AAAA,wCAC9B4B,EAAiBE,CAAc;AAAA,KAClE,CACL,GAAG",
  "names": ["import_fs", "import_path", "import_csv_parse", "import_lz_ts", "import_s2_geometry", "import_url", "import_meta", "compressToURI", "lzTs", "S2", "s2geo", "__filename", "__dirname", "csvParser", "transformCountryListIso2ToCodeLookupMap", "countriesList", "countryMapIso2", "country", "index", "getRawCityCountryList", "citiesAndCountries", "minPopulation", "resolve", "data", "record", "cityNameAscii", "lat", "lng", "iso2", "capital", "population", "latFloat", "lngFloat", "a", "b", "encodeData", "rows", "currentCountryCode", "row", "nextRow", "compressBaseData", "countryIso2", "baseDataCities"]
}
